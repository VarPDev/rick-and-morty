import { Injectable } from '@angular/core';
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Observable } from 'rxjs';
import { environment } from 'src/environments/environment';
import { Character, CharacterResponse } from 'src/app/models/character.vm';
import {
  charactersUpdateAction,
  characterUpdateAction,
} from 'src/app/store/actions/rick-and-morty.action';
import { Store, select } from '@ngrx/store';

@Injectable({
  providedIn: 'root',
})
export class RickAndMortyService {
  readonly rickAndMortyUrl: string = environment.rick_and_morty_url;

  readonly characters$: Observable<CharacterResponse>;
  readonly character$: Observable<Character>;

  readonly httpOptions: {} = {
    headers: new HttpHeaders({ 'Content-Type': 'application/json' }),
  };

  constructor(
    private readonly httpClient: HttpClient,
    private readonly store: Store<{
      characters: CharacterResponse;
      character: Character;
    }>
  ) {
    this.characters$ = store.pipe(select('characters'));
    this.character$ = store.pipe(select('character'));
    console.log(this.character$);
  }

  getCharacters(url: string = null): Observable<CharacterResponse> {
    return this.httpClient.get<CharacterResponse>(
      !!url ? url : `${this.rickAndMortyUrl}/character`,
      this.httpOptions
    );
  }

  getCharacter(id: string): Observable<Character> {
    return this.httpClient.get<Character>(
      `${this.rickAndMortyUrl}/character/${id}`,
      this.httpOptions
    );
  }

  createGetRequest(url: string): Observable<any> {
    return this.httpClient.get<any>(url, this.httpOptions);
  }

  /*
   ▄         ▄  ▄▄▄▄▄▄▄▄▄▄▄  ▄▄▄▄▄▄▄▄▄▄   ▄▄▄▄▄▄▄▄▄▄▄  ▄▄▄▄▄▄▄▄▄▄▄  ▄▄▄▄▄▄▄▄▄▄▄  ▄▄▄▄▄▄▄▄▄▄▄
  ▐░▌       ▐░▌▐░░░░░░░░░░░▌▐░░░░░░░░░░▌ ▐░░░░░░░░░░░▌▐░░░░░░░░░░░▌▐░░░░░░░░░░░▌▐░░░░░░░░░░░▌
  ▐░▌       ▐░▌▐░█▀▀▀▀▀▀▀█░▌▐░█▀▀▀▀▀▀▀█░▌▐░█▀▀▀▀▀▀▀█░▌ ▀▀▀▀█░█▀▀▀▀ ▐░█▀▀▀▀▀▀▀▀▀ ▐░█▀▀▀▀▀▀▀▀▀
  ▐░▌       ▐░▌▐░▌       ▐░▌▐░▌       ▐░▌▐░▌       ▐░▌     ▐░▌     ▐░▌          ▐░▌
  ▐░▌       ▐░▌▐░█▄▄▄▄▄▄▄█░▌▐░▌       ▐░▌▐░█▄▄▄▄▄▄▄█░▌     ▐░▌     ▐░█▄▄▄▄▄▄▄▄▄ ▐░█▄▄▄▄▄▄▄▄▄
  ▐░▌       ▐░▌▐░░░░░░░░░░░▌▐░▌       ▐░▌▐░░░░░░░░░░░▌     ▐░▌     ▐░░░░░░░░░░░▌▐░░░░░░░░░░░▌
  ▐░▌       ▐░▌▐░█▀▀▀▀▀▀▀▀▀ ▐░▌       ▐░▌▐░█▀▀▀▀▀▀▀█░▌     ▐░▌     ▐░█▀▀▀▀▀▀▀▀▀  ▀▀▀▀▀▀▀▀▀█░▌
  ▐░▌       ▐░▌▐░▌          ▐░▌       ▐░▌▐░▌       ▐░▌     ▐░▌     ▐░▌                    ▐░▌
  ▐░█▄▄▄▄▄▄▄█░▌▐░▌          ▐░█▄▄▄▄▄▄▄█░▌▐░▌       ▐░▌     ▐░▌     ▐░█▄▄▄▄▄▄▄▄▄  ▄▄▄▄▄▄▄▄▄█░▌
  ▐░░░░░░░░░░░▌▐░▌          ▐░░░░░░░░░░▌ ▐░▌       ▐░▌     ▐░▌     ▐░░░░░░░░░░░▌▐░░░░░░░░░░░▌
   ▀▀▀▀▀▀▀▀▀▀▀  ▀            ▀▀▀▀▀▀▀▀▀▀   ▀         ▀       ▀       ▀▀▀▀▀▀▀▀▀▀▀  ▀▀▀▀▀▀▀▀▀▀▀

  */

  updateCharacters(value: CharacterResponse): void {
    this.store.dispatch(charactersUpdateAction({ characters: value }));
  }

  updateCharacter(value: Character): void {
    this.store.dispatch(characterUpdateAction({ character: value }));
  }
}
